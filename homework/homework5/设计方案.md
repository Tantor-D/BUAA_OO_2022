# 简介

## 问题

1. 参考网上的代码，
2. 考虑输出采用春日野草的时间戳的方法
3. 输出线程安全的问题，可以用单例模式解决？

## 概述

设计中线程一共有7个，主线程、输入线程、电梯线程。

使用调度器，调度器从InputThread中接收输入信息，并将不同的请求分配到不同的电梯中。分配到列表中后，让全部的电梯都收到消息来接人。



调度器是静态的，内部封存了请求队列，其会因为本身为空且无请求而停止

一旦有了新的输入，直接就将其进行分类，添加进processQueue中，然后`notifyall()`（相当于notify了所有的用此列表的电梯），由电梯自己决定来不来取。



Elevator、InputHandler都需要有自己的waitlist的引用

几乎全部的同步代码都在RequestQueue类中

## 关于输入和输出

### 输入

注意要与Schedule进行交互，使用同步方法`AddRequest()`进行request的添加

### 输出

把上面的问题看完

## elevator

看看内部保存哪些信息比较合适：

`方向、乘客列表（一个requestQueue）、last op（开关门，用于看这一步做啥 and 最后输出关门）`

电梯的行为比较简单，getRequest保证了它移动的方向不会变化，所以到了新的一楼只需要看看要不要放人下来就可以了

电梯的操作：`决定现在的操作` -> `选择新加的人` -> `输出`

### 调度策略

电梯首先看看是不是一切都结束了

​	一切结束->processQueue标记为空

然后看自己有没有人

- 有人
  - 看看要不要放人下去
  - 看本楼层上有没有人要上电梯，有的话就接，优先接当前楼层的，接了就在processQueue中删掉这个请求
  - 如果上完人后
- 无人
  - 看看所有楼层中有没有请求
    - 没有的话就wait。注意要在请求的函数中进行wait，限定锁是那个列表（所以给这个函数传参的时候要记住加上一个人数的信息）
    - 有的话选一个去 ==看看调度策略==



**暂时不考虑优化**
